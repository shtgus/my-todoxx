<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ä¸“æ³¨æ¸…å• Pro - è§†è§‰é‡æ„ç‰ˆ</title>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <style>
        :root {
            --bg: #F8FAFC; 
            --card: #FFFFFF; 
            --text-main: #1E293B; 
            --text-sec: #64748B;
            --primary: #E08E8E; /* è«å…°è¿ªç²‰ */
            --primary-light: #FDF2F2;
            --secondary: #60A5FA; /* è«å…°è¿ªè“ */
            --border: #E2E8F0;
            --shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.05), 0 2px 4px -1px rgba(0, 0, 0, 0.03);
            --radius: 16px;
        }

        body {
            font-family: 'PingFang SC', 'Hiragino Sans GB', 'Microsoft YaHei', sans-serif;
            background: var(--bg); color: var(--text-main);
            margin: 0; display: flex; flex-direction: column; height: 100vh; overflow: hidden;
        }

        /* é¡¶éƒ¨åŒæ­¥æ  */
        .sync-banner { 
            background: #1E293B; color: #94A3B8; padding: 8px 24px; 
            display: flex; justify-content: space-between; align-items: center; 
            font-size: 0.7rem; z-index: 1000;
        }
        .sync-banner input { 
            background: rgba(255,255,255,0.05); border: 1px solid #334155; 
            color: #F8FAFC; border-radius: 6px; padding: 4px 10px; outline: none; width: 140px;
            transition: 0.3s;
        }
        .sync-banner input:focus { border-color: var(--secondary); background: rgba(255,255,255,0.1); }

        /* ä¸»ä½“å¸ƒå±€ */
        .app-shell {
            display: grid; grid-template-columns: 260px 1fr 300px;
            gap: 20px; flex: 1; padding: 20px; box-sizing: border-box; overflow: hidden;
        }

        .panel {
            background: var(--card); border-radius: var(--radius);
            box-shadow: var(--shadow); display: flex; flex-direction: column;
            overflow: hidden; border: 1px solid var(--border);
        }

        /* å·¦ä¾§å¯¼èˆª */
        .panel-header { padding: 20px; border-bottom: 1px solid var(--border); }
        .nav-section { padding: 12px 0; border-bottom: 1px solid var(--border); }
        .nav-item { 
            padding: 10px 20px; margin: 2px 12px; cursor: pointer; border-radius: 10px; 
            font-size: 0.9rem; color: var(--text-sec); display: flex; align-items: center; gap: 10px;
            transition: all 0.2s ease;
        }
        .nav-item:hover { background: #F1F5F9; color: var(--text-main); }
        .nav-item.active { background: var(--primary-light); color: var(--primary); font-weight: 600; }
        
        .archive-header { 
            padding: 16px 20px 8px; font-size: 0.8rem; font-weight: bold; 
            color: var(--text-sec); text-transform: uppercase; letter-spacing: 0.05em;
        }
        .tag-tree { flex: 1; overflow-y: auto; padding: 0 10px 20px; }
        .tag-node { 
            font-size: 0.8rem; padding: 8px 12px; cursor: pointer; border-radius: 8px; 
            color: var(--text-sec); margin: 2px 4px; display: flex; justify-content: space-between;
            transition: 0.2s;
        }
        .tag-node:hover { background: var(--primary-light); color: var(--primary); }
        .tag-node.active { background: var(--primary-light); color: var(--primary); font-weight: 600; }
        .tag-count { font-size: 0.7rem; opacity: 0.5; }

        /* ä¸­é—´åˆ—è¡¨ */
        .stats-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 16px; margin-bottom: 20px; }
        .stat-box { background: var(--card); padding: 16px; border-radius: var(--radius); border: 1px solid var(--border); text-align: center; }
        .stat-num { font-size: 1.25rem; font-weight: 700; color: var(--primary); }
        .stat-label { font-size: 0.7rem; color: var(--text-sec); margin-top: 4px; }

        .input-container { 
            background: var(--card); padding: 16px; border-radius: var(--radius); 
            border: 1px solid var(--border); margin-bottom: 20px; box-shadow: var(--shadow);
        }
        .input-main { display: flex; gap: 12px; align-items: center; }
        .input-main input[type="text"] { 
            flex: 1; border: none; outline: none; font-size: 1rem; color: var(--text-main); 
        }
        .input-main input[type="text"]::placeholder { color: #CBD5E1; }
        
        .input-sub { display: flex; align-items: center; justify-content: space-between; margin-top: 12px; padding-top: 12px; border-top: 1px dotted var(--border); }
        .quick-dates { display: flex; gap: 6px; }
        .date-chip { 
            font-size: 0.7rem; padding: 4px 10px; background: #F1F5F9; 
            border-radius: 6px; cursor: pointer; color: var(--text-sec); border: 1px solid transparent;
        }
        .date-chip:hover { border-color: var(--border); background: #E2E8F0; }

        .todo-list { flex: 1; padding: 8px; }
        .todo-item { 
            display: flex; align-items: center; padding: 12px 16px; 
            border-radius: 12px; margin-bottom: 4px; transition: 0.2s;
            position: relative;
        }
        .todo-item:hover { background: #F8FAFC; }
        .todo-content { flex: 1; display: flex; align-items: center; gap: 12px; cursor: pointer; }
        .todo-text { font-size: 0.95rem; }
        .todo-meta { font-size: 0.7rem; color: var(--text-sec); margin-left: auto; margin-right: 40px; }
        
        .todo-item .actions { position: absolute; right: 16px; display: none; gap: 8px; }
        .todo-item:hover .actions { display: flex; }
        .action-icon { cursor: pointer; font-size: 0.75rem; color: var(--text-sec); padding: 4px; }
        .action-icon:hover { color: var(--primary); }

        /* å³ä¾§ç•ªèŒ„é’Ÿä¸çµæ„Ÿ */
        .pomo-wrap { padding: 24px; text-align: center; }
        .timer-display { font-size: 3rem; font-weight: 300; color: var(--primary); margin: 10px 0; font-variant-numeric: tabular-nums; }
        
        .note-card { 
            background: #F8FAFC; border-radius: 12px; padding: 16px; margin-bottom: 12px; 
            font-size: 0.85rem; border-left: 4px solid var(--primary); /* ç»Ÿä¸€é¢œè‰²ä¸ºè«å…°è¿ªç²‰ */
        }

        /* æ»šåŠ¨æ¡ */
        .scroll { overflow-y: auto; scrollbar-width: none; }
        .scroll::-webkit-scrollbar { display: none; }

        /* æŒ‰é’® */
        button { 
            background: var(--primary); color: white; border: none; padding: 8px 16px; 
            border-radius: 10px; cursor: pointer; font-size: 0.85rem; font-weight: 500;
        }
        button:hover { opacity: 0.9; transform: translateY(-1px); }
        .btn-outline { background: #F1F5F9; color: var(--text-sec); }

        .search-mini {
            margin: 10px 16px; padding: 6px 12px; border: 1px solid var(--border);
            border-radius: 8px; font-size: 0.75rem; width: calc(100% - 32px); outline: none;
        }

        .filter-banner {
            background: var(--primary-light); color: var(--primary);
            padding: 8px 16px; border-radius: 10px; margin: 0 8px 12px;
            display: flex; justify-content: space-between; align-items: center;
            font-size: 0.85rem; font-weight: 600;
        }
        .clear-filter { cursor: pointer; opacity: 0.7; }
        .clear-filter:hover { opacity: 1; }
    </style>
</head>
<body>

<div class="sync-banner">
    <div>Status: <span id="sync-status" style="color:#10B981">Local Mode</span></div>
    <div>
        Sync Key: <input type="password" id="sync-code" placeholder="Enter key..." onblur="initSupabase()">
    </div>
</div>

<div class="app-shell">
    <!-- å·¦è¾¹æ ï¼šæ—¶é—´ç»´åº¦å¯¼èˆª -->
    <div class="panel">
        <div class="panel-header">
            <div id="live-time" style="font-size: 1.8rem; font-weight: 300; color: var(--primary);"></div>
            <div id="live-date" style="color: var(--text-sec); font-size: 0.8rem; margin-top: 4px;"></div>
        </div>
        
        <div class="nav-section">
            <div class="nav-item active" id="nav-today" onclick="setFilter('today', this)">
                <span>ğŸ“…</span> ä»Šæ—¥äº‹é¡¹
            </div>
            <div class="nav-item" id="nav-week" onclick="setFilter('week', this)">
                <span>ğŸ—“ï¸</span> æœ¬å‘¨äº‹é¡¹
            </div>
            <div class="nav-item" id="nav-all" onclick="setFilter('all', this)">
                <span>ğŸ“‚</span> æ‰€æœ‰äº‹é¡¹
            </div>
            <div class="nav-item" id="nav-done" onclick="setFilter('done', this)">
                <span>âœ…</span> å·²å®Œæˆå†…å®¹
            </div>
        </div>
        
        <div class="archive-header">çµæ„Ÿå­˜æ¡£ (Tags)</div>
        <input type="text" class="search-mini" placeholder="æœç´¢å†…å®¹..." oninput="memoSearchText = this.value; renderTagTree(); render();">
        <div id="tag-tree-container" class="tag-tree scroll"></div>
    </div>

    <!-- ä¸­é—´ï¼šä»»åŠ¡åˆ—è¡¨ -->
    <div style="display: flex; flex-direction: column;">
        <div class="stats-grid">
            <div class="stat-box">
                <div id="stat-progress" class="stat-num">0%</div>
                <div class="stat-label">ä»Šæ—¥è¿›åº¦</div>
            </div>
            <div class="stat-box">
                <div id="stat-pending" class="stat-num">0</div>
                <div class="stat-label">å¾…åŠä»»åŠ¡</div>
            </div>
            <div class="stat-box">
                <div id="stat-focus" class="stat-num">0</div>
                <div class="stat-label">ä¸“æ³¨ç•ªèŒ„</div>
            </div>
        </div>

        <div class="input-container" id="main-input-area">
            <div class="input-main">
                <input type="text" id="t-input" placeholder="å‡†å¤‡åšç‚¹ä»€ä¹ˆï¼Ÿ" onkeydown="if(event.keyCode==13) addTask()">
                <input type="date" id="t-date" style="border:none; color:var(--text-sec); font-size:0.8rem; cursor:pointer;">
            </div>
            <div class="input-sub">
                <div class="quick-dates">
                    <div class="date-chip" onclick="setQuickDate(0)">ä»Šå¤©</div>
                    <div class="date-chip" onclick="setQuickDate(1)">æ˜å¤©</div>
                    <div class="date-chip" onclick="setQuickDate(2)">åå¤©</div>
                </div>
                <button onclick="addTask()">æ·»åŠ ä»»åŠ¡</button>
            </div>
        </div>

        <div class="panel scroll" style="flex: 1;">
            <div id="current-filter-info"></div>
            <div id="list-container" class="todo-list"></div>
        </div>
    </div>

    <!-- å³è¾¹æ ï¼šä¸“æ³¨ä¸ç¬”è®° -->
    <div style="display: flex; flex-direction: column; gap: 20px;">
        <div class="panel pomo-wrap">
            <div style="font-size:0.8rem; color:var(--text-sec)">ä¸“æ³¨å€’è®¡æ—¶</div>
            <div id="timer-val" class="timer-display">25:00</div>
            <div style="display: flex; gap: 10px; margin-top: 10px; justify-content: center;">
                <button id="p-start" onclick="togglePomo()" style="padding: 8px 24px;">å¼€å§‹</button>
                <button onclick="resetPomo()" class="btn-outline">é‡ç½®</button>
            </div>
        </div>

        <div class="panel scroll" style="flex: 1; padding: 20px;">
            <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:16px;">
                <span id="note-type-label" style="font-weight:600; color:var(--primary)">ğŸ’¡ çµæ„Ÿç¬”è®°</span>
                <button onclick="toggleNoteEditor()" style="padding:4px 10px; font-size:0.7rem;">+ æ–°å»º</button>
            </div>
            
            <div id="note-display">
                <div id="book-desc" class="note-card"></div>
                <button onclick="nextBook()" class="btn-outline" style="width:100%; font-size:0.75rem;">æ¢ä¸ªçµæ„Ÿ</button>
            </div>

            <div id="note-editor" style="display:none;">
                <textarea id="n-content" placeholder="è¾“å…¥æƒ³æ³•ï¼Œä½¿ç”¨ #æ ‡ç­¾ è‡ªåŠ¨å½’æ¡£..." style="width:100%; height:140px; border:1px solid var(--border); border-radius:12px; padding:10px; font-size:0.8rem; resize:none; outline:none;"></textarea>
                <div style="display:flex; gap:8px; margin-top:10px;">
                    <button onclick="saveNote()" style="flex:1">ä¿å­˜</button>
                    <button onclick="toggleNoteEditor()" class="btn-outline">å–æ¶ˆ</button>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    // --- æ•°æ®åˆå§‹åŒ– ---
    const SB_URL = 'https://jmkbmedqxcjefmnygyby.supabase.co'; 
    const SB_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Impta2JtZWRxeGNqZWZtbnlneWJ5Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzAwNjEyMTgsImV4cCI6MjA4NTYzNzIxOH0.x2BbeuxwPe8MEop7hzvZo0fZ9LRmNm3Jj5JgAA0MzXQ'; 
    let supabaseClient = null;

    let tasks = JSON.parse(localStorage.getItem('tasks_v88')) || [];
    let myNotes = JSON.parse(localStorage.getItem('my_notes_v88')) || [];
    let pomoCount = parseInt(localStorage.getItem('pomo_v88')) || 0;
    
    let currentFilter = 'today'; 
    let activeTag = null; // å½“å‰æ¿€æ´»çš„æ ‡ç­¾ç­›é€‰
    let memoSearchText = '';

    window.onload = function() {
        updateClock(); setInterval(updateClock, 1000);
        setQuickDate(0);
        render(); renderTagTree(); nextBook();
    };

    // --- åŒæ­¥æ ¸å¿ƒ ---
    async function initSupabase() {
        const code = document.getElementById('sync-code').value;
        if (!code || typeof supabase === 'undefined') return;
        try {
            supabaseClient = supabase.createClient(SB_URL, SB_KEY);
            const { data } = await supabaseClient.from('focus_data').select('*').eq('sync_code', code).single();
            if (data) {
                tasks = data.tasks || []; myNotes = data.notes || []; pomoCount = data.pomo || 0;
                saveLocally(); render(); renderTagTree();
                document.getElementById('sync-status').innerText = 'Connected';
            } else { saveCloud(); }
        } catch(e) { console.error(e); }
    }
    async function saveCloud() {
        const code = document.getElementById('sync-code').value;
        if (!supabaseClient || !code) return;
        await supabaseClient.from('focus_data').upsert({ sync_code: code, tasks, pomo: pomoCount, notes: myNotes });
    }
    function saveLocally() {
        localStorage.setItem('tasks_v88', JSON.stringify(tasks));
        localStorage.setItem('my_notes_v88', JSON.stringify(myNotes));
        localStorage.setItem('pomo_v88', pomoCount);
    }
    function save() { saveLocally(); saveCloud(); render(); renderTagTree(); }

    // --- å·¥å…·å‡½æ•° ---
    function updateClock() {
        const now = new Date();
        document.getElementById('live-time').innerText = now.toLocaleTimeString('zh-CN', {hour:'2-digit', minute:'2-digit'});
        document.getElementById('live-date').innerText = now.toLocaleDateString('zh-CN', {weekday:'long', month:'long', day:'numeric'});
    }

    function setQuickDate(offset) {
        const d = new Date();
        d.setDate(d.getDate() + offset);
        document.getElementById('t-date').value = d.toISOString().split('T')[0];
    }

    function getWeekRange() {
        const now = new Date();
        const firstDay = new Date(now.setDate(now.getDate() - now.getDay()));
        const lastDay = new Date(now.setDate(now.getDate() - now.getDay() + 6));
        return { start: firstDay.toISOString().split('T')[0], end: lastDay.toISOString().split('T')[0] };
    }

    // --- å¯¼èˆªä¸è¿‡æ»¤ ---
    function setFilter(f, el) { 
        currentFilter = f; 
        activeTag = null; // åˆ‡æ¢æ—¶é—´ç»´åº¦æ—¶æ¸…é™¤æ ‡ç­¾ç­›é€‰
        document.querySelectorAll('.nav-item').forEach(x => x.classList.remove('active'));
        document.querySelectorAll('.tag-node').forEach(x => x.classList.remove('active'));
        if (el) el.classList.add('active');
        render(); 
    }

    function setTagFilter(tag) {
        activeTag = tag;
        currentFilter = 'tag'; // ç‰¹æ®Šç»´åº¦
        document.querySelectorAll('.nav-item').forEach(x => x.classList.remove('active'));
        render();
        renderTagTree(); // æ›´æ–°æ ‡ç­¾æ ‘çš„é€‰ä¸­çŠ¶æ€
    }

    function clearTagFilter() {
        setFilter('today', document.getElementById('nav-today'));
    }

    // --- æ ¸å¿ƒæ¸²æŸ“ ---
    function render() {
        const container = document.getElementById('list-container');
        const filterInfo = document.getElementById('current-filter-info');
        container.innerHTML = '';
        filterInfo.innerHTML = '';
        
        const todayStr = new Date().toISOString().split('T')[0];
        const week = getWeekRange();

        // æ ‡ç­¾ç­›é€‰æ¨¡å¼
        if (currentFilter === 'tag' && activeTag) {
            filterInfo.innerHTML = `
                <div class="filter-banner">
                    <span>æ­£åœ¨æŸ¥çœ‹æ ‡ç­¾: #${activeTag}</span>
                    <span class="clear-filter" onclick="clearTagFilter()">æ¸…é™¤ç­›é€‰ âœ•</span>
                </div>
            `;
            
            const filteredNotes = myNotes.filter(n => {
                const tags = n.parsedTags || [];
                const isUnclassified = tags.length === 0 && activeTag === "æœªåˆ†ç±»";
                return tags.includes(activeTag) || isUnclassified;
            });

            filteredNotes.forEach(n => {
                const item = document.createElement('div');
                item.className = 'todo-item';
                item.innerHTML = `
                    <div class="todo-content">
                        <span style="font-size: 1.2rem; margin-right: 8px;">ğŸ’¡</span>
                        <span class="todo-text">${n.desc}</span>
                        <span class="todo-meta">${n.time.split(' ')[0]}</span>
                    </div>
                `;
                container.appendChild(item);
            });

            if(filteredNotes.length === 0) {
                container.innerHTML = `<div style="text-align:center; color:#CBD5E1; margin-top:40px; font-size:0.8rem;">è¯¥æ ‡ç­¾ä¸‹æš‚æ— çµæ„Ÿ</div>`;
            }
            updateStats();
            return;
        }

        // å¸¸è§„ä»»åŠ¡è¿‡æ»¤é€»è¾‘
        let filteredTasks = tasks;
        if (currentFilter === 'today') {
            filteredTasks = tasks.filter(t => !t.done && (t.date === todayStr || t.date < todayStr));
        } else if (currentFilter === 'week') {
            filteredTasks = tasks.filter(t => !t.done && t.date >= week.start && t.date <= week.end);
        } else if (currentFilter === 'done') {
            filteredTasks = tasks.filter(t => t.done);
        } else if (currentFilter === 'all') {
            filteredTasks = tasks.filter(t => !t.done);
        }

        // æœç´¢è¿‡æ»¤
        if (memoSearchText) {
            filteredTasks = filteredTasks.filter(t => t.name.includes(memoSearchText));
        }

        // æ’åº
        filteredTasks.sort((a,b) => (b.pinned - a.pinned) || (a.date > b.date ? 1 : -1));

        filteredTasks.forEach(t => {
            const item = document.createElement('div');
            item.className = 'todo-item';
            item.innerHTML = `
                <div class="todo-content" onclick="toggleTask(${t.id})">
                    <input type="checkbox" ${t.done?'checked':''}>
                    <span class="todo-text" style="text-decoration:${t.done?'line-through':'none'}; color:${t.done?'#94A3B8':'inherit'}">
                        ${t.pinned ? 'ğŸ“Œ ' : ''}${t.name}
                    </span>
                    <span class="todo-meta">${t.date === todayStr ? 'ä»Šå¤©' : t.date.slice(5)}</span>
                </div>
                <div class="actions">
                    <span class="action-icon" onclick="pinTask(${t.id})">ğŸ“</span>
                    <span class="action-icon" onclick="deleteTask(${t.id})" style="color:#F87171">âœ•</span>
                </div>
            `;
            container.appendChild(item);
        });

        if(filteredTasks.length === 0) {
            container.innerHTML = `<div style="text-align:center; color:#CBD5E1; margin-top:40px; font-size:0.8rem;">æš‚æ— å†…å®¹</div>`;
        }

        updateStats();
    }

    function updateStats() {
        const todayStr = new Date().toISOString().split('T')[0];
        const todayTasks = tasks.filter(t => t.date === todayStr);
        const doneToday = todayTasks.filter(t => t.done).length;
        const progress = todayTasks.length ? Math.round((doneToday / todayTasks.length) * 100) : 0;
        
        document.getElementById('stat-progress').innerText = progress + '%';
        document.getElementById('stat-pending').innerText = tasks.filter(x=>!x.done).length;
        document.getElementById('stat-focus').innerText = pomoCount;
    }

    // --- ä»»åŠ¡æ“ä½œ ---
    function addTask() {
        const input = document.getElementById('t-input');
        if(!input.value.trim()) return;
        tasks.push({ 
            id: Date.now(), 
            name: input.value, 
            date: document.getElementById('t-date').value || new Date().toISOString().split('T')[0], 
            done: false,
            pinned: false 
        });
        input.value = ""; save();
    }
    function toggleTask(id) { const t = tasks.find(x=>x.id===id); if(t){t.done=!t.done; save();} }
    function pinTask(id) { const t = tasks.find(x=>x.id===id); if(t){t.pinned=!t.pinned; save();} }
    function deleteTask(id) { tasks = tasks.filter(x=>x.id!==id); save(); }

    // --- çµæ„Ÿéƒ¨åˆ† (æ ‡ç­¾æ ‘ä¸å›é¡¾) ---
    function renderTagTree() {
        const container = document.getElementById('tag-tree-container');
        const tagCounts = {};
        myNotes.forEach(m => {
            const tags = m.parsedTags && m.parsedTags.length ? m.parsedTags : ["æœªåˆ†ç±»"];
            tags.forEach(t => tagCounts[t] = (tagCounts[t] || 0) + 1);
        });
        
        let html = '';
        Object.keys(tagCounts).sort().forEach(tag => {
            const isActive = activeTag === tag;
            html += `<div class="tag-node ${isActive?'active':''}" onclick="setTagFilter('${tag}')">
                <span># ${tag}</span><span class="tag-count">${tagCounts[tag]}</span>
            </div>`;
        });
        container.innerHTML = html;
    }

    function toggleNoteEditor() {
        const d = document.getElementById('note-display'), e = document.getElementById('note-editor');
        d.style.display = d.style.display === 'none' ? 'block' : 'none';
        e.style.display = e.style.display === 'none' ? 'block' : 'none';
    }

    function saveNote() {
        const content = document.getElementById('n-content').value.trim();
        if(!content) return;
        const tags = content.match(/#([^\s#]+)/g)?.map(t => t.slice(1)) || [];
        myNotes.push({ id: Date.now(), desc: content, parsedTags: tags, time: new Date().toLocaleString() });
        document.getElementById('n-content').value = '';
        toggleNoteEditor(); save(); nextBook();
    }

    function nextBook() {
        if(!myNotes.length) { document.getElementById('book-desc').innerText = "è¿˜æ²¡æœ‰è®°å½•çµæ„Ÿï¼Œå†™ä¸‹ä¸€æ¡å§ï¼"; return; }
        const b = myNotes[Math.floor(Math.random() * myNotes.length)];
        document.getElementById('book-desc').innerText = b.desc;
    }

    // --- ç•ªèŒ„é’Ÿ ---
    let pTime=1500, pInt=null;
    function resetPomo() { pTime=1500; updatePomoDisp(); clearInterval(pInt); pInt=null; document.getElementById('p-start').innerText='å¼€å§‹'; }
    function togglePomo() {
        if(pInt) { clearInterval(pInt); pInt=null; document.getElementById('p-start').innerText='ç»§ç»­'; }
        else { 
            document.getElementById('p-start').innerText='æš‚åœ';
            pInt=setInterval(()=>{ pTime--; updatePomoDisp(); if(pTime<=0){pomoCount++; save(); resetPomo(); alert('ç•ªèŒ„æ—¶é—´åˆ°ï¼ä¼‘æ¯ä¸€ä¸‹å§ã€‚');}},1000); 
        }
    }
    function updatePomoDisp() { const m=Math.floor(pTime/60), s=pTime%60; document.getElementById('timer-val').innerText=`${String(m).padStart(2,'0')}:${String(s).padStart(2,'0')}`; }
</script>
</body>
</html>
